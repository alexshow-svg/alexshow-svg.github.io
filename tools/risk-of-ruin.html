<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Risk of Ruin • Risk & Discipline Library</title>
  <meta name="description" content="A simple risk-of-ruin tool to estimate how likely you are to blow up after a losing streak, based on risk per trade and drawdown limit." />
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <header class="container header">
    <div class="brand">
      <a class="logo" href="../index.html">Risk & Discipline Library</a>
      <div class="tagline">How likely are you to blow up from a losing streak?</div>
    </div>
    <nav class="nav">
      <a href="../library.html">Library</a>
      <a href="../tools.html">Tools</a>
      <a href="../about.html">About</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <h1>Risk of Ruin (simple)</h1>
      <p class="muted">
        This is a simplified educational model. It does <strong>not</strong> predict markets.
        It shows how position sizing + losing streaks can mathematically trap you.
      </p>

      <div class="kpi" style="margin-top:12px;">
        <div class="card">
          <div class="small">Max Losing Streak Before Limit</div>
          <div id="maxStreak" class="big">—</div>
          <div class="small">How many losses in a row until you hit your drawdown limit</div>
        </div>
        <div class="card">
          <div class="small">Chance of at least one such streak</div>
          <div id="streakProb" class="big">—</div>
          <div class="small">Estimated probability across N trades</div>
        </div>
      </div>

      <hr />

      <label>Risk per Trade (%)</label>
      <input id="riskPct" type="number" min="0.01" step="0.01" placeholder="e.g. 1" />

      <label>Win Rate (%)</label>
      <input id="winRate" type="number" min="1" max="99" step="0.1" placeholder="e.g. 45" />

      <label>Drawdown Limit (%)</label>
      <input id="ddLimit" type="number" min="1" max="99" step="0.1" placeholder="e.g. 20" />

      <label>Number of Trades (simulation horizon)</label>
      <input id="nTrades" type="number" min="10" step="1" placeholder="e.g. 200" />

      <button class="button" id="calcBtn" style="margin-top:14px;">Calculate</button>

      <p id="note" class="muted" style="margin-top:12px;"></p>

      <hr />

      <h2>How to use this safely</h2>
      <ul class="muted">
        <li>This assumes each trade risks the same percent and results are independent (real life is messier).</li>
        <li>“Drawdown limit” is a personal stop line (example: you stop trading at -20% to reset).</li>
        <li>If the chance is high, you don’t need a “better strategy” — you need smaller risk.</li>
      </ul>

      <p class="muted">
        Related: <a href="../articles/position-sizing.html">Position sizing (concept)</a> •
        <a href="../tools/position-size.html">Position size calculator</a>
      </p>
    </section>
  </main>

  <footer class="container footer">
    <div class="muted">Educational only • <a href="../legal.html">Disclaimers</a></div>
  </footer>

  <script>
    function round(n, d = 2) {
      const p = Math.pow(10, d);
      return Math.round(n * p) / p;
    }

    function formatPct(n, d = 2) {
      if (!isFinite(n)) return "—";
      return round(n, d).toLocaleString(undefined, { maximumFractionDigits: d }) + "%";
    }

    // Approximate probability of at least one run of k losses in N trades.
    // We use a simple approximation: expected number of k-loss runs ≈ (N - k + 1) * q^k
    // Then P(at least one) ≈ 1 - exp(-expected_runs)
    // This is not exact, but it's intuitive and good for education.
    function probAtLeastOneRun(N, k, q) {
      if (k <= 0) return 1;
      if (N < k) return 0;
      const expectedRuns = (N - k + 1) * Math.pow(q, k);
      const p = 1 - Math.exp(-expectedRuns);
      return Math.min(1, Math.max(0, p));
    }

    function calculate() {
      const riskPct = Number(document.getElementById("riskPct").value);
      const winRate = Number(document.getElementById("winRate").value);
      const ddLimit = Number(document.getElementById("ddLimit").value);
      const nTrades = Number(document.getElementById("nTrades").value);

      const maxStreakEl = document.getElementById("maxStreak");
      const streakProbEl = document.getElementById("streakProb");
      const noteEl = document.getElementById("note");

      maxStreakEl.textContent = "—";
      streakProbEl.textContent = "—";
      noteEl.textContent = "";

      if (![riskPct, winRate, ddLimit, nTrades].every(v => isFinite(v) && v > 0)) {
        noteEl.textContent = "Fill all fields with numbers greater than 0.";
        return;
      }
      if (winRate >= 100) {
        noteEl.textContent = "Win rate must be less than 100%.";
        return;
      }
      if (winRate <= 0) {
        noteEl.textContent = "Win rate must be greater than 0%.";
        return;
      }
      if (ddLimit >= 100) {
        noteEl.textContent = "Drawdown limit must be less than 100%.";
        return;
      }
      if (nTrades < 10) {
        noteEl.textContent = "Use at least 10 trades for a meaningful horizon.";
        return;
      }

      const q = 1 - (winRate / 100); // loss probability

      // Conservative streak threshold:
      // k losses * riskPct ≈ ddLimit  => k ≈ ddLimit / riskPct
      // We floor it, because you hit/overflow the limit at that streak length.
      const k = Math.floor(ddLimit / riskPct);

      if (k <= 0) {
        noteEl.textContent = "With this risk per trade and drawdown limit, one loss could already hit your limit.";
        maxStreakEl.textContent = "0";
        streakProbEl.textContent = "Very high";
        return;
      }

      const pRun = probAtLeastOneRun(Math.floor(nTrades), k, q);

      maxStreakEl.textContent = String(k) + " losses";
      streakProbEl.textContent = formatPct(pRun * 100, 2);

      // Guidance note
      const riskMsg =
        (pRun >= 0.5)
          ? "High: a blow-up streak is likely over this many trades. Reduce risk per trade or lower trade frequency."
          : (pRun >= 0.2)
            ? "Medium: it can happen. Be disciplined with size and daily stop rules."
            : "Lower: still possible, but sizing is more survivable.";

      noteEl.textContent =
        `With win rate ${round(winRate,1)}% and risk ${round(riskPct,2)}% per trade, about ${k} losses in a row would reach ~${round(ddLimit,1)}% drawdown. Estimated chance of at least one such streak over ${Math.floor(nTrades)} trades: ${formatPct(pRun * 100, 2)}. ${riskMsg}`;
    }

    document.getElementById("calcBtn").addEventListener("click", calculate);
  </script>
</body>
</html>
